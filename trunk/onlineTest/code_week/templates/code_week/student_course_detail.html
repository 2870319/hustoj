{% extends 'base.html' %}
{% block extrahead %}
    {% load static %}
    <script src="{% static 'assets/js/bootstrap-table.min.js' %}"></script>
    <link href="{% static 'assets/css/bootstrap-table.min.css' %}" rel="stylesheet">
    <script src="{% static 'assets/js/bootstrap-table-zh-CN.min.js' %}"></script>
{% endblock %}
{% block content %}
{% if course %}
    <p>课程名称: {{ course.name }}</p>
    <p>开始时间: {{ course.begin_time }}</p>
    <p>结束时间: {{ course.end_time }}</p>
    <p>课程人数限制： {{ course.numberEachGroup }}</p>
    <p>课程题目</p>
    <table id="table"
           data-toggle="table"
           data-url="{% url 'get_problem_student' course.id %}"
           data-side-pagination="server"
           data-pagination="true"
           data-page-list="[10, 20, 50, 100, 200]"
           data-classes="table table-hover table-condensed"
           data-toolbar="#toolbar"
           data-striped="true"
           data-query-params="queryParams"
           data-search="false"
    >
        <thead>
        <tr>
            <th class="nobr" data-field="title" data-sortable="true">标题</th>
            <th class="nobr" data-field="category"> 题目分类</th>
            <th class="nobr" data-field="outline">题目描述</th>
        </tr>
        </thead>
    </table>
    <button class="btn btn-success" id="leader">成为组长</button>
    <script type="text/javascript">
        var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
        var chatsock = new WebSocket(ws_scheme + '://' + window.location.host  + window.location.pathname);
        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'}
        });
         $.ajax({
                    type:"GET",
                    url:"{% url 'student_info' course.id %}",
                    dataType:"json",
                    success:function(data){
                        alert(str(data));
                    },
                    error:function(jqXHR){
                        alert("error" + jqXHR.status);
                    }
                });
        $('#leader').click(function () {
            var message = {
                action: "c",
            }
            chatsock.send(JSON.stringify(message));
        });
        chatsock.onmessage = function(message) {
        var data = JSON.parse(message.data);
            console.log(message.data);
        };
        var $table = $('#table');
        $ok = $('#ok');
        $(function () {
            $ok.click(function () {
                $table.bootstrapTable('refresh');
            });
        });
        function queryParams(params) {
            $('#toolbar').find('select[name]').each(function () {
                params[$(this).attr('name')] = $(this).val();
            });
            return params;
        }
    </script>
{% endif %}
{% endblock %}